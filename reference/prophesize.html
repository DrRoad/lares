<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>####################################################################
#' Machine Learning Forecast
#' 
#' This function lets the user create a forecast setting a time series
#' and a numerical value.
#' 
#' @family Forecast
#' @param time POSIX. Vector with dates or time values
#' @param values Numeric. Vector with numerical values
#' @param n_future Integer. How many steps do you wish to forecast?
#' @param use_last Boolean. Use last observation?
#' @param automl Boolean. Use lares::h2o_automl()
#' @param plot_forecast Boolean. If you wish to plot your results
#' @param plot_model Boolean. If you wish to plot your model's results
#' @param project Character. Name of your forecast project for plot title
#' @export
forecast_ml &lt;- function(time, values, 
                        n_future = 15, 
                        use_last = TRUE, 
                        automl = FALSE, 
                        plot_forecast = TRUE, 
                        plot_model = FALSE,
                        project = "Simple Forecast using Machine Learning") 
  
  # require(timetk)
  # require(tidyquant)
  
  if (length(time) != length(values)) 
    stop("The parameters 'time' and 'values' should have the same length")
  
  
  df &lt;- data.frame(time = time, amount = values)
  if (use_last == FALSE) 
    df &lt;- arrange(df, desc(.data$time)) <!-- %&gt;% slice(-1) -->
    n_future &lt;- n_future + 1
  
  
  # STEP 1: AUGMENT TIME SERIES SIGNATURE
  augmented &lt;- tk_augment_timeseries_signature(df)
  augmented &lt;- mutate(augmented, 
                      month.lbl = as.character(.data$month.lbl),
                      wday.lbl = as.character(.data$wday.lbl))
  
  # STEP 2: BUILD FUTURE (NEW) DATA
  idx &lt;- tk_index(augmented)
  future_idx &lt;- tk_make_future_timeseries(idx, n_future = n_future)
  new_data_tbl &lt;- tk_get_timeseries_signature(future_idx) <!-- %&gt;% -->
    mutate(month.lbl = as.character(month.lbl),
           wday.lbl = as.character(wday.lbl))
  
  # STEP 3: MODEL
  if (!automl) 
    fit_lm &lt;- lm(amount ~ ., data = select(augmented, -c(time)))
    pred &lt;- predict(fit_lm, newdata = select(new_data_tbl, -c(index)))
    predictions_tbl &lt;- tibble(time = future_idx, amount = pred) 
   else 
    augmented_h2o &lt;- dplyr::rename(augmented, tag = amount)
    fit_auto &lt;- h2o_automl(df = augmented_h2o, alarm = FALSE, project = project)
    pred &lt;- h2o.predict(fit_auto$model, as.h2o(new_data_tbl))
    predictions_tbl &lt;- tibble(time = future_idx, amount = as.vector(pred))
  
  
  # STEP 5: COMPARE ACTUAL VS PREDICTIONS
  rects &lt;- data.frame(start = min(future_idx), end = max(future_idx))
  message("Predicted range: ", rects$start, " to ", rects$end)
  forecast &lt;- ggplot(df, aes(x = time, y = amount)) + 
    labs(title = project, y = "Amount", x = NULL,
         subtitle = "Using simple multivariate regressions on time series with Machine Learning") +
    # Training data
    geom_line(color = palette_light()[[1]]) +
    geom_point(color = palette_light()[[1]]) +
    geom_smooth(method = 'loess', formula = 'y ~ x', alpha = 0.5) +
    # Predictions
    geom_line(aes(y = amount), color = palette_light()[[2]], data = predictions_tbl) +
    geom_point(aes(y = amount), color = palette_light()[[2]], data = predictions_tbl) +
    # Actuals
    geom_line(color = palette_light()[[1]], data = df) +
    geom_point(color = palette_light()[[1]], data = df) +
    # Aesthetics
    scale_x_date(date_breaks = "1 month", date_labels = "<!-- %b") + -->
    theme_lares2() + 
    geom_rect(data = rects, inherit.aes = FALSE, 
              aes(
                xmin = start, xmax = end, ymin = 0,
                ymax = max(df$amount) * 1.02), 
              color = "transparent", fill = "orange", alpha = 0.3)
  
  if (plot_forecast) 
    print(forecast)
  
  
  if (plot_model) 
    Sys.sleep(1)
    mplot_full(
      tag = df$amount, 
      score = predictions_tbl$amount[1:length(df$amount)],
      subtitle = project)
    Sys.sleep(4)
  
  
  df_final &lt;- rbind(df, predictions_tbl)
  
  if (automl) 
    model &lt;- fit_auto
    score &lt;- fit_auto$scores$score
   else 
    model &lt;- fit_lm
    score &lt;- fit_lm$fitted.values
  
  
  output &lt;- list(data = df_final, 
                 model = model, 
                 errors = errors(df$amount, score))
  
  return(output)
  
  
Facebook's Prophet Forecast — prophesize • lares</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="####################################################################
#' Machine Learning Forecast
#' 
#' This function lets the user create a forecast setting a time series
#' and a numerical value.
#' 
#' @family Forecast
#' @param time POSIX. Vector with dates or time values
#' @param values Numeric. Vector with numerical values
#' @param n_future Integer. How many steps do you wish to forecast?
#' @param use_last Boolean. Use last observation?
#' @param automl Boolean. Use lares::h2o_automl()
#' @param plot_forecast Boolean. If you wish to plot your results
#' @param plot_model Boolean. If you wish to plot your model's results
#' @param project Character. Name of your forecast project for plot title
#' @export
forecast_ml &lt;- function(time, values, 
                        n_future = 15, 
                        use_last = TRUE, 
                        automl = FALSE, 
                        plot_forecast = TRUE, 
                        plot_model = FALSE,
                        project = "Simple Forecast using Machine Learning") 
  
  # require(timetk)
  # require(tidyquant)
  
  if (length(time) != length(values)) 
    stop("The parameters 'time' and 'values' should have the same length")
  
  
  df &lt;- data.frame(time = time, amount = values)
  if (use_last == FALSE) 
    df &lt;- arrange(df, desc(.data$time)) <!-- %&gt;% slice(-1) -->
    n_future &lt;- n_future + 1
  
  
  # STEP 1: AUGMENT TIME SERIES SIGNATURE
  augmented &lt;- tk_augment_timeseries_signature(df)
  augmented &lt;- mutate(augmented, 
                      month.lbl = as.character(.data$month.lbl),
                      wday.lbl = as.character(.data$wday.lbl))
  
  # STEP 2: BUILD FUTURE (NEW) DATA
  idx &lt;- tk_index(augmented)
  future_idx &lt;- tk_make_future_timeseries(idx, n_future = n_future)
  new_data_tbl &lt;- tk_get_timeseries_signature(future_idx) <!-- %&gt;% -->
    mutate(month.lbl = as.character(month.lbl),
           wday.lbl = as.character(wday.lbl))
  
  # STEP 3: MODEL
  if (!automl) 
    fit_lm &lt;- lm(amount ~ ., data = select(augmented, -c(time)))
    pred &lt;- predict(fit_lm, newdata = select(new_data_tbl, -c(index)))
    predictions_tbl &lt;- tibble(time = future_idx, amount = pred) 
   else 
    augmented_h2o &lt;- dplyr::rename(augmented, tag = amount)
    fit_auto &lt;- h2o_automl(df = augmented_h2o, alarm = FALSE, project = project)
    pred &lt;- h2o.predict(fit_auto$model, as.h2o(new_data_tbl))
    predictions_tbl &lt;- tibble(time = future_idx, amount = as.vector(pred))
  
  
  # STEP 5: COMPARE ACTUAL VS PREDICTIONS
  rects &lt;- data.frame(start = min(future_idx), end = max(future_idx))
  message("Predicted range: ", rects$start, " to ", rects$end)
  forecast &lt;- ggplot(df, aes(x = time, y = amount)) + 
    labs(title = project, y = "Amount", x = NULL,
         subtitle = "Using simple multivariate regressions on time series with Machine Learning") +
    # Training data
    geom_line(color = palette_light()[[1]]) +
    geom_point(color = palette_light()[[1]]) +
    geom_smooth(method = 'loess', formula = 'y ~ x', alpha = 0.5) +
    # Predictions
    geom_line(aes(y = amount), color = palette_light()[[2]], data = predictions_tbl) +
    geom_point(aes(y = amount), color = palette_light()[[2]], data = predictions_tbl) +
    # Actuals
    geom_line(color = palette_light()[[1]], data = df) +
    geom_point(color = palette_light()[[1]], data = df) +
    # Aesthetics
    scale_x_date(date_breaks = "1 month", date_labels = "<!-- %b") + -->
    theme_lares2() + 
    geom_rect(data = rects, inherit.aes = FALSE, 
              aes(
                xmin = start, xmax = end, ymin = 0,
                ymax = max(df$amount) * 1.02), 
              color = "transparent", fill = "orange", alpha = 0.3)
  
  if (plot_forecast) 
    print(forecast)
  
  
  if (plot_model) 
    Sys.sleep(1)
    mplot_full(
      tag = df$amount, 
      score = predictions_tbl$amount[1:length(df$amount)],
      subtitle = project)
    Sys.sleep(4)
  
  
  df_final &lt;- rbind(df, predictions_tbl)
  
  if (automl) 
    model &lt;- fit_auto
    score &lt;- fit_auto$scores$score
   else 
    model &lt;- fit_lm
    score &lt;- fit_lm$fitted.values
  
  
  output &lt;- list(data = df_final, 
                 model = model, 
                 errors = errors(df$amount, score))
  
  return(output)
  
  
Facebook's Prophet Forecast — prophesize" />
<meta property="og:description" content="Prophet is Facebook's procedure for forecasting time series data 
based on an additive model where non-linear trends are fit with 
yearly, weekly, and daily seasonality, plus holiday effects. It 
works best with time series that have strong seasonal effects and 
several seasons of historical data. Prophet is robust to missing 
data and shifts in the trend, and typically handles outliers well." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lares</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">4.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/laresbernardo/lares/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>####################################################################
#' Machine Learning Forecast
#' 
#' This function lets the user create a forecast setting a time series
#' and a numerical value.
#' 
#' @family Forecast
#' @param time POSIX. Vector with dates or time values
#' @param values Numeric. Vector with numerical values
#' @param n_future Integer. How many steps do you wish to forecast?
#' @param use_last Boolean. Use last observation?
#' @param automl Boolean. Use lares::h2o_automl()
#' @param plot_forecast Boolean. If you wish to plot your results
#' @param plot_model Boolean. If you wish to plot your model's results
#' @param project Character. Name of your forecast project for plot title
#' @export
forecast_ml &lt;- function(time, values, 
                        n_future = 15, 
                        use_last = TRUE, 
                        automl = FALSE, 
                        plot_forecast = TRUE, 
                        plot_model = FALSE,
                        project = "Simple Forecast using Machine Learning") 
  
  # require(timetk)
  # require(tidyquant)
  
  if (length(time) != length(values)) 
    stop("The parameters 'time' and 'values' should have the same length")
  
  
  df &lt;- data.frame(time = time, amount = values)
  if (use_last == FALSE) 
    df &lt;- arrange(df, desc(.data$time)) <!-- %&gt;% slice(-1) -->
    n_future &lt;- n_future + 1
  
  
  # STEP 1: AUGMENT TIME SERIES SIGNATURE
  augmented &lt;- tk_augment_timeseries_signature(df)
  augmented &lt;- mutate(augmented, 
                      month.lbl = as.character(.data$month.lbl),
                      wday.lbl = as.character(.data$wday.lbl))
  
  # STEP 2: BUILD FUTURE (NEW) DATA
  idx &lt;- tk_index(augmented)
  future_idx &lt;- tk_make_future_timeseries(idx, n_future = n_future)
  new_data_tbl &lt;- tk_get_timeseries_signature(future_idx) <!-- %&gt;% -->
    mutate(month.lbl = as.character(month.lbl),
           wday.lbl = as.character(wday.lbl))
  
  # STEP 3: MODEL
  if (!automl) 
    fit_lm &lt;- lm(amount ~ ., data = select(augmented, -c(time)))
    pred &lt;- predict(fit_lm, newdata = select(new_data_tbl, -c(index)))
    predictions_tbl &lt;- tibble(time = future_idx, amount = pred) 
   else 
    augmented_h2o &lt;- dplyr::rename(augmented, tag = amount)
    fit_auto &lt;- h2o_automl(df = augmented_h2o, alarm = FALSE, project = project)
    pred &lt;- h2o.predict(fit_auto$model, as.h2o(new_data_tbl))
    predictions_tbl &lt;- tibble(time = future_idx, amount = as.vector(pred))
  
  
  # STEP 5: COMPARE ACTUAL VS PREDICTIONS
  rects &lt;- data.frame(start = min(future_idx), end = max(future_idx))
  message("Predicted range: ", rects$start, " to ", rects$end)
  forecast &lt;- ggplot(df, aes(x = time, y = amount)) + 
    labs(title = project, y = "Amount", x = NULL,
         subtitle = "Using simple multivariate regressions on time series with Machine Learning") +
    # Training data
    geom_line(color = palette_light()[[1]]) +
    geom_point(color = palette_light()[[1]]) +
    geom_smooth(method = 'loess', formula = 'y ~ x', alpha = 0.5) +
    # Predictions
    geom_line(aes(y = amount), color = palette_light()[[2]], data = predictions_tbl) +
    geom_point(aes(y = amount), color = palette_light()[[2]], data = predictions_tbl) +
    # Actuals
    geom_line(color = palette_light()[[1]], data = df) +
    geom_point(color = palette_light()[[1]], data = df) +
    # Aesthetics
    scale_x_date(date_breaks = "1 month", date_labels = "<!-- %b") + -->
    theme_lares2() + 
    geom_rect(data = rects, inherit.aes = FALSE, 
              aes(
                xmin = start, xmax = end, ymin = 0,
                ymax = max(df$amount) * 1.02), 
              color = "transparent", fill = "orange", alpha = 0.3)
  
  if (plot_forecast) 
    print(forecast)
  
  
  if (plot_model) 
    Sys.sleep(1)
    mplot_full(
      tag = df$amount, 
      score = predictions_tbl$amount[1:length(df$amount)],
      subtitle = project)
    Sys.sleep(4)
  
  
  df_final &lt;- rbind(df, predictions_tbl)
  
  if (automl) 
    model &lt;- fit_auto
    score &lt;- fit_auto$scores$score
   else 
    model &lt;- fit_lm
    score &lt;- fit_lm$fitted.values
  
  
  output &lt;- list(data = df_final, 
                 model = model, 
                 errors = errors(df$amount, score))
  
  return(output)
  
  
Facebook's Prophet Forecast</h1>
    <small class="dont-index">Source: <a href='https://github.com/laresbernardo/lares/blob/master/R/forecasting.R'><code>R/forecasting.R</code></a></small>
    <div class="hidden name"><code>prophesize.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Prophet is Facebook's procedure for forecasting time series data 
based on an additive model where non-linear trends are fit with 
yearly, weekly, and daily seasonality, plus holiday effects. It 
works best with time series that have strong seasonal effects and 
several seasons of historical data. Prophet is robust to missing 
data and shifts in the trend, and typically handles outliers well.</p>
    </div>

    <pre class="usage"><span class='fu'>prophesize</span>(
  <span class='no'>df</span>,
  <span class='kw'>n_future</span> <span class='kw'>=</span> <span class='fl'>60</span>,
  <span class='kw'>country</span> <span class='kw'>=</span> <span class='st'>"AR"</span>,
  <span class='kw'>trend.param</span> <span class='kw'>=</span> <span class='fl'>0.05</span>,
  <span class='kw'>logged</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>pout</span> <span class='kw'>=</span> <span class='fl'>0.03</span>,
  <span class='kw'>project</span> <span class='kw'>=</span> <span class='st'>"Prophet Forecast"</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>df</th>
      <td><p>Data frame. Must contain date/time column and values column</p></td>
    </tr>
    <tr>
      <th>n_future</th>
      <td><p>Integer. How many steps do you wish to forecast?</p></td>
    </tr>
    <tr>
      <th>country</th>
      <td><p>Character. Country code for holidays</p></td>
    </tr>
    <tr>
      <th>trend.param</th>
      <td><p>Numeric. Flexibility of trend component. Default is 0.05, 
and as this value becomes larger, the trend component will be more flexible.</p></td>
    </tr>
    <tr>
      <th>logged</th>
      <td><p>Boolean. Convert values into logs?</p></td>
    </tr>
    <tr>
      <th>pout</th>
      <td><p>Numeric. Get rid of pout % of outliers</p></td>
    </tr>
    <tr>
      <th>project</th>
      <td><p>Character. Name of your forecast project for plot title</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Official documentation: <a href='https://github.com/facebook/prophet'>https://github.com/facebook/prophet</a></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other Forecast: 
<code><a href='forecast_arima.html'>forecast_arima</a>()</code></p></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Bernardo Lares.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


